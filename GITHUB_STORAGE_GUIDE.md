# GitHub存储和权限设置使用指南

## 🚀 新功能概述

本次更新为桑梓平台添加了两个重要功能：

1. **GitHub仓库存储**：用户上传的作品可以直接保存到GitHub仓库中
2. **完整权限设置**：支持公开、私有、仅好友、自定义等多种权限级别

## 📋 GitHub存储配置

### 1. 创建GitHub Personal Access Token

1. 访问 [GitHub Settings > Developer settings > Personal access tokens](https://github.com/settings/tokens)
2. 点击 "Generate new token (classic)"
3. 设置Token名称，如 "Serial_story_upload"
4. 选择权限范围，**必须包含**：
   - `repo` - 完整的仓库访问权限
   - `contents:write` - 写入仓库内容的权限
5. 点击 "Generate token" 并**立即复制保存**（只显示一次）

### 2. 在平台中配置Token

1. 以管理员身份登录平台
2. 进入"作品上传"页面
3. 在页面顶部会显示"GitHub存储配置"区域
4. 输入您的GitHub Token
5. 点击"保存配置"
6. 点击"测试连接"验证配置是否正确

### 3. 文件存储结构

上传的文件将按以下结构保存到GitHub仓库：

```
Serial_story/
├── user-uploads/
│   ├── literature/          # 文学作品
│   │   ├── essays/          # 生活随笔
│   │   ├── poetry/          # 诗歌创作
│   │   └── novels/          # 小说连载
│   ├── artworks/            # 绘画作品
│   ├── music/               # 音乐作品
│   └── videos/              # 视频作品
└── user-data/
    ├── permissions/         # 权限设置
    └── metadata/           # 元数据
```

## 🔐 权限设置功能

### 权限级别说明

1. **🌍 公开**：所有访问者都可以查看
2. **👥 仅好友可见**：只有好友级别及以上用户可以查看
3. **👤 访客及以上可见**：访客、好友、管理员都可以查看
4. **⚙️ 自定义权限**：可以设置白名单或黑名单
5. **🔒 私有**：只有作者自己可以查看

### 自定义权限设置

#### 白名单模式
- 只有指定的用户可以查看作品
- 适用于分享给特定朋友的私人作品

#### 黑名单模式
- 除了指定用户外，所有好友级别用户都可以查看
- 适用于屏蔽特定用户的场景

### 权限设置步骤

1. 在上传作品时，选择"访问权限"
2. 如果选择"自定义权限"：
   - 选择白名单或黑名单模式
   - 在用户列表中输入用户名（用逗号分隔）
   - 查看权限预览确认设置
3. 提交作品

## 🔧 技术实现

### 存储策略

- **优先级**：GitHub存储 > 本地存储
- **回退机制**：如果GitHub上传失败，自动使用本地存储
- **兼容性**：保持与现有本地存储系统的完全兼容

### 权限验证

权限验证在以下场景生效：
- 作品列表显示
- 作品详情查看
- 文件下载访问
- 评论权限检查

### 数据安全

- GitHub Token仅存储在浏览器本地
- 所有API调用使用HTTPS加密
- 权限设置支持细粒度控制
- 支持权限修改和撤销

## 📝 使用示例

### 示例1：上传私人日记

1. 选择"文学作品" > "生活随笔"
2. 填写标题和内容
3. 权限设置选择"🔒 私有"
4. 点击"发布作品"

### 示例2：分享给特定朋友的照片

1. 选择"绘画作品" > "绘画作品"
2. 上传图片文件
3. 权限设置选择"⚙️ 自定义权限"
4. 选择"白名单模式"
5. 输入朋友的用户名：`friend1, friend2`
6. 点击"发布作品"

### 示例3：公开发布音乐作品

1. 选择"音乐作品" > "原创音乐"
2. 上传音频文件
3. 权限设置选择"🌍 公开"
4. 点击"发布作品"

## 🐛 故障排除

### GitHub连接问题

**问题**：测试连接失败
**解决方案**：
1. 检查Token是否正确复制
2. 确认Token权限包含`repo`
3. 检查网络连接
4. 验证GitHub账户状态

### 上传失败问题

**问题**：文件上传到GitHub失败
**解决方案**：
1. 检查文件大小（限制10MB）
2. 确认Token权限
3. 检查仓库是否存在
4. 查看浏览器控制台错误信息

### 权限设置问题

**问题**：权限设置不生效
**解决方案**：
1. 刷新页面重新登录
2. 检查用户角色设置
3. 确认权限配置正确保存
4. 清除浏览器缓存

## 📞 获取帮助

如果遇到问题，请：

1. 查看浏览器控制台错误信息
2. 使用测试页面验证功能：`/test-upload-features.html`
3. 在GitHub Issues中报告问题
4. 联系管理员获取技术支持

## 🔄 版本更新

### v2.0.0 (当前版本)
- ✅ 添加GitHub仓库存储支持
- ✅ 完善权限设置系统
- ✅ 添加白名单/黑名单功能
- ✅ 权限预览和说明
- ✅ 错误处理和回退机制

### 计划中的功能
- 📋 批量权限管理
- 🔄 权限继承机制
- 📊 访问统计功能
- 🔔 权限变更通知

---

**注意**：GitHub Token是敏感信息，请妥善保管，不要分享给他人。如果Token泄露，请立即在GitHub中撤销并重新生成。
